-- 1)
ALTER TYPE STOCK_T ADD MEMBER FUNCTION YIELD RETURN FLOAT CASCADE

/

ALTER TYPE STOCK_T ADD MEMBER FUNCTION PRICEINUSD(RATE FLOAT) RETURN FLOAT CASCADE

/

ALTER TYPE STOCK_T ADD MEMBER FUNCTION NOOFEXS RETURN INT CASCADE

/

CREATE OR REPLACE TYPE BODY STOCK_T AS
    MEMBER FUNCTION YIELD RETURN FLOAT IS
    BEGIN
        RETURN ((SELF.DIVIDEND / SELF.PRICE) * 100);
    END YIELD;
    MEMBER FUNCTION PRICEINUSD(
        RATE FLOAT
    ) RETURN FLOAT AS
    BEGIN
        RETURN PRICE * RATE;
    END PRICEINUSD;
    MEMBER FUNCTION NOOFEXS RETURN INT IS
        RESULT INT;
    BEGIN
        SELECT
            COUNT(E.COLUMN_VALUE) INTO RESULT
        FROM
            STOCKS S,
            TABLE (S.EXCHANGES) E
        WHERE
            S.COMPANY = SELF.COMPANY;
        RETURN RESULT;
    END NOOFEXS;
END;
/

COMMIT

/

SELECT
    S.COMPANY,
    S.DIVIDEND,
    S.PRICE,
    S.YIELD(),
    S.PRICEINUSD(0.5),
    S.NOOFEXS()
FROM
    STOCKS S

/

ALTER TYPE CLIENT_T ADD MEMBER FUNCTION TOTALVALUE RETURN FLOAT CASCADE

/

ALTER TYPE CLIENT_T ADD MEMBER FUNCTION TOTALPROFIT RETURN FLOAT CASCADE

/

CREATE OR REPLACE TYPE BODY CLIENT_T AS
    MEMBER FUNCTION TOTALVALUE RETURN FLOAT IS
        RESULT FLOAT;
    BEGIN
        SELECT
            SUM(I.PRICE * I.QTY) INTO RESULT
        FROM
            CLIENTS C,
            TABLE(C.INVESTMENTS) I
        WHERE
            C.CLNO = SELF.CLNO;
        RETURN RESULT;
    END;
    MEMBER FUNCTION TOTALPROFIT RETURN FLOAT IS
        RESULT FLOAT;
    BEGIN
        SELECT
            SUM((I.COMPANY.PRICE - I.PRICE) * I.QTY) INTO RESULT
        FROM
            CLIENTS C,
            TABLE(C.INVESTMENTS) I
        WHERE
            C.CLNO = SELF.CLNO;
        RETURN RESULT;
    END;
END;
/

-- CREATE OR REPLACE TYPE BODY CLIENT_T AS
--     MEMBER FUNCTION TOTALVALUE RETURN FLOAT IS
--         RESULT FLOAT;
--     BEGIN
--         SELECT
--             SUM(I.PRICE * I.QTY) INTO RESULT
--         FROM
--             TABLE(SELF.INVESTMENTS) I RETURN RESULT;
--     END TOTALVALUE;
--     MEMBER FUNCTION TOTALPROFIT RETURN FLOAT IS
--         RESULT FLOAT;
--     BEGIN
--         SELECT
--             SUM((I.COMPANY.PRICE - I.PRICE) * I.QTY) INTO RESULT
--         FROM
--             TABLE(SELF.INVESTMENTS) I RETURN RESULT;
--     END TOTALPROFIT;
-- END;
-- /

COMMIT

/

SELECT
    C.CLNO,
    C.NAME,
    C.TOTALVALUE(),
    C.TOTALPROFIT()
FROM
    CLIENTS C

/

-- 2)
-- a)
SELECT
    S.COMPANY,
    S.EXCHANGES,
    E.COLUMN_VALUE     "exchanges",
    S.YIELD()          "yield",
    S.PRICEINUSD(0.74) "price(USD)"
FROM
    STOCKS S,
    TABLE(S.EXCHANGES) E

/

-- b)
SELECT
    S.COMPANY,
    S.PRICE,
    S.NOOFEXS() "No of exs"
FROM
    STOCKS S
WHERE
    S.NOOFEXS() > 1

/

-- c)
SELECT
    C.NAME,
    I.COMPANY.COMPANY,
    I.COMPANY.YIELD(),
    I.COMPANY.PRICE "Current price",
    (I.COMPANY.PRICE - I.PRICE) "EPS"
FROM
    CLIENTS C,
    TABLE(C.INVESTMENTS) I

/

-- d)
SELECT
    C.NAME,
    C.TOTALVALUE()
FROM
    CLIENTS C

/

-- e)
SELECT
    C.NAME,
    C.TOTALVALUE(),
    C.TOTALPROFIT()
FROM
    CLIENTS C

/